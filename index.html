<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RÃ¡dio FM Streaming</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Space Grotesk', sans-serif; }
    
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 1; }
      100% { transform: scale(1.4); opacity: 0; }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes wave {
      0%, 100% { height: 8px; }
      50% { height: 24px; }
    }
    
    .playing-indicator span {
      display: inline-block;
      width: 4px;
      background: currentColor;
      margin: 0 2px;
      border-radius: 2px;
      animation: wave 0.8s ease-in-out infinite;
    }
    
    .playing-indicator span:nth-child(2) { animation-delay: 0.1s; }
    .playing-indicator span:nth-child(3) { animation-delay: 0.2s; }
    .playing-indicator span:nth-child(4) { animation-delay: 0.3s; }
    .playing-indicator span:nth-child(5) { animation-delay: 0.4s; }
    
    .radio-card:hover { transform: translateY(-4px); }
    .radio-card { transition: all 0.3s ease; }
    
    .gradient-bg {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b4e 100%);
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .now-playing-pulse::before {
      content: '';
      position: absolute;
      inset: -4px;
      border-radius: 50%;
      background: inherit;
      animation: pulse-ring 1.5s ease-out infinite;
      z-index: -1;
    }
    
    .search-glow:focus {
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
    }
    
    .scrollbar-thin::-webkit-scrollbar { width: 6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 3px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.5); border-radius: 3px; }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full gradient-bg text-white overflow-hidden">
  <div id="app" class="h-full flex flex-col"><!-- Header -->
   <header class="p-6 pb-4">
    <div class="flex items-center justify-between mb-6">
     <div class="flex items-center gap-3">
      <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
       </svg>
      </div>
      <div>
       <h1 id="app-title" class="text-2xl font-bold bg-gradient-to-r from-violet-400 to-fuchsia-400 bg-clip-text text-transparent">RÃ¡dio FM</h1>
       <p class="text-sm text-gray-400">Descubra estaÃ§Ãµes ao redor do mundo</p>
      </div>
     </div>
     <div id="live-badge" class="hidden px-3 py-1 rounded-full bg-red-500/20 border border-red-500/50 text-red-400 text-sm font-medium flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span> AO VIVO
     </div>
    </div><!-- Search -->
    <div class="relative">
     <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
     </svg><input type="text" id="search-input" placeholder="Buscar rÃ¡dios por nome, paÃ­s ou gÃªnero..." class="w-full pl-12 pr-4 py-4 rounded-2xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-violet-500/50 search-glow transition-all"> <button id="clear-search" class="hidden absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div><!-- Genre Filters -->
    <div class="flex gap-2 mt-4 overflow-x-auto pb-2 scrollbar-thin"><button data-genre="all" class="genre-btn active px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all bg-violet-500 text-white"> Todas </button> <button data-genre="pop" class="genre-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all bg-white/10 text-gray-300 hover:bg-white/20"> Pop </button> <button data-genre="rock" class="genre-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all bg-white/10 text-gray-300 hover:bg-white/20"> Rock </button> <button data-genre="jazz" class="genre-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all bg-white/10 text-gray-300 hover:bg-white/20"> Jazz </button> <button data-genre="classical" class="genre-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all bg-white/10 text-gray-300 hover:bg-white/20"> ClÃ¡ssica </button> <button data-genre="electronic" class="genre-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all bg-white/10 text-gray-300 hover:bg-white/20"> EletrÃ´nica </button> <button data-genre="brasil" class="genre-btn px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all bg-white/10 text-gray-300 hover:bg-white/20"> ðŸ‡§ðŸ‡· Brasil </button>
    </div>
   </header><!-- Radio List -->
   <main id="radio-list" class="flex-1 overflow-y-auto px-6 pb-32 scrollbar-thin">
    <div id="loading" class="flex flex-col items-center justify-center py-12">
     <div class="w-16 h-16 border-4 border-violet-500/30 border-t-violet-500 rounded-full animate-spin mb-4"></div>
     <p class="text-gray-400">Buscando estaÃ§Ãµes...</p>
    </div>
    <div id="stations-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 hidden"></div>
    <div id="no-results" class="hidden flex flex-col items-center justify-center py-12 text-center">
     <svg class="w-16 h-16 text-gray-600 mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
     </svg>
     <p class="text-gray-400 text-lg">Nenhuma estaÃ§Ã£o encontrada</p>
     <p class="text-gray-500 text-sm mt-1">Tente buscar por outro termo</p>
    </div>
   </main><!-- Now Playing Bar -->
   <div id="player-bar" class="fixed bottom-0 left-0 right-0 glass-card border-t border-white/10 p-4 transform translate-y-full transition-transform duration-300">
    <div class="flex items-center gap-4">
     <div id="player-icon" class="relative w-14 h-14 rounded-xl bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center flex-shrink-0"><span class="text-2xl" id="player-emoji">ðŸ“»</span>
     </div>
     <div class="flex-1 min-w-0">
      <h3 id="player-name" class="font-semibold truncate">Selecione uma rÃ¡dio</h3>
      <p id="player-info" class="text-sm text-gray-400 truncate">--</p>
     </div>
     <div class="playing-indicator text-violet-400 hidden" id="playing-waves"><span></span><span></span><span></span><span></span><span></span>
     </div><button id="play-btn" class="w-12 h-12 rounded-full bg-violet-500 hover:bg-violet-400 flex items-center justify-center transition-colors flex-shrink-0">
      <svg id="play-icon" class="w-6 h-6" fill="currentColor" viewbox="0 0 24 24"><path d="M8 5v14l11-7z" />
      </svg>
      <svg id="pause-icon" class="w-6 h-6 hidden" fill="currentColor" viewbox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" />
      </svg></button> <button id="volume-btn" class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors flex-shrink-0">
      <svg id="volume-on" class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
      </svg>
      <svg id="volume-off" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
      </svg></button>
    </div>
   </div>
  </div><!-- Hidden Audio Element -->
  <audio id="audio-player" crossorigin="anonymous"></audio>
  <script>
    // Default configuration
    const defaultConfig = {
      app_title: 'RÃ¡dio FM',
      search_placeholder: 'Buscar rÃ¡dios por nome, paÃ­s ou gÃªnero...',
      primary_color: '#8b5cf6',
      secondary_color: '#1a1a3e',
      text_color: '#ffffff',
      accent_color: '#d946ef',
      surface_color: '#0f0f23'
    };

    // Radio stations database (using free radio browser API)
    const API_BASE = 'https://de1.api.radio-browser.info/json';
    
    let stations = [];
    let currentStation = null;
    let isPlaying = false;
    let isMuted = false;
    let currentGenre = 'all';
    
    const audio = document.getElementById('audio-player');
    const searchInput = document.getElementById('search-input');
    const clearSearchBtn = document.getElementById('clear-search');
    const stationsGrid = document.getElementById('stations-grid');
    const loadingEl = document.getElementById('loading');
    const noResultsEl = document.getElementById('no-results');
    const playerBar = document.getElementById('player-bar');
    const playBtn = document.getElementById('play-btn');
    const volumeBtn = document.getElementById('volume-btn');
    const liveBadge = document.getElementById('live-badge');
    
    // Fetch stations from Radio Browser API
    async function fetchStations(searchTerm = '', genre = 'all') {
      loadingEl.classList.remove('hidden');
      stationsGrid.classList.add('hidden');
      noResultsEl.classList.add('hidden');
      
      try {
        let url = `${API_BASE}/stations/search?limit=30&hidebroken=true&order=clickcount&reverse=true`;
        
        if (searchTerm) {
          url += `&name=${encodeURIComponent(searchTerm)}`;
        }
        
        if (genre !== 'all') {
          if (genre === 'brasil') {
            url += '&country=Brazil';
          } else {
            url += `&tag=${genre}`;
          }
        }
        
        const response = await fetch(url, {
          headers: { 'User-Agent': 'CanvaRadioApp/1.0' }
        });
        
        if (!response.ok) throw new Error('Failed to fetch');
        
        stations = await response.json();
        
        // Filter to only stations with working URLs
        stations = stations.filter(s => s.url_resolved && s.url_resolved.length > 0);
        
        renderStations();
      } catch (error) {
        console.error('Error fetching stations:', error);
        // Fallback to sample stations if API fails
        stations = getSampleStations();
        renderStations();
      }
    }
    
    // Sample stations fallback
    function getSampleStations() {
      return [
        { name: 'Jazz FM', url_resolved: 'https://stream.jazzfm.ro/live.mp3', country: 'RomÃªnia', tags: 'jazz', favicon: '', codec: 'MP3' },
        { name: 'Classic FM', url_resolved: 'https://media-ice.musicradio.com/ClassicFMMP3', country: 'Reino Unido', tags: 'classical', favicon: '', codec: 'MP3' },
        { name: 'Radio Paradise', url_resolved: 'https://stream.radioparadise.com/mp3-192', country: 'EUA', tags: 'rock,pop', favicon: '', codec: 'MP3' },
        { name: 'FIP Radio', url_resolved: 'https://icecast.radiofrance.fr/fip-midfi.mp3', country: 'FranÃ§a', tags: 'jazz,world', favicon: '', codec: 'MP3' },
        { name: 'Antena 1', url_resolved: 'https://stream.antena1.com.br/a1sert', country: 'Brasil', tags: 'pop,brasil', favicon: '', codec: 'MP3' },
        { name: 'SomaFM Groove Salad', url_resolved: 'https://somafm.com/groovesalad256.pls', country: 'EUA', tags: 'electronic,ambient', favicon: '', codec: 'MP3' }
      ];
    }
    
    // Render stations to grid
    function renderStations() {
      loadingEl.classList.add('hidden');
      
      if (stations.length === 0) {
        noResultsEl.classList.remove('hidden');
        stationsGrid.classList.add('hidden');
        return;
      }
      
      stationsGrid.innerHTML = '';
      
      stations.forEach((station, index) => {
        const card = document.createElement('div');
        card.className = 'radio-card glass-card rounded-2xl p-4 cursor-pointer hover:bg-white/10';
        card.dataset.index = index;
        
        const emoji = getStationEmoji(station.tags || '');
        const isActive = currentStation && currentStation.name === station.name;
        
        card.innerHTML = `
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-xl ${isActive ? 'bg-gradient-to-br from-violet-500 to-fuchsia-500' : 'bg-gradient-to-br from-violet-600/50 to-fuchsia-600/50'} flex items-center justify-center flex-shrink-0">
              ${station.favicon ? `<img src="${station.favicon}" class="w-10 h-10 rounded-lg object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" loading="lazy"><span class="text-2xl hidden">${emoji}</span>` : `<span class="text-2xl">${emoji}</span>`}
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-semibold truncate ${isActive ? 'text-violet-400' : ''}">${station.name}</h3>
              <p class="text-sm text-gray-400 truncate">${station.country || 'Internacional'} â€¢ ${station.tags?.split(',')[0] || 'MÃºsica'}</p>
            </div>
            ${isActive && isPlaying ? `
              <div class="playing-indicator text-violet-400">
                <span></span><span></span><span></span><span></span><span></span>
              </div>
            ` : ''}
          </div>
        `;
        
        card.addEventListener('click', () => selectStation(index));
        stationsGrid.appendChild(card);
      });
      
      stationsGrid.classList.remove('hidden');
    }
    
    // Get emoji based on genre
    function getStationEmoji(tags) {
      const t = tags.toLowerCase();
      if (t.includes('jazz')) return 'ðŸŽ·';
      if (t.includes('classical')) return 'ðŸŽ»';
      if (t.includes('rock')) return 'ðŸŽ¸';
      if (t.includes('electronic') || t.includes('techno')) return 'ðŸŽ§';
      if (t.includes('pop')) return 'ðŸŽ¤';
      if (t.includes('brasil') || t.includes('brazil')) return 'ðŸ‡§ðŸ‡·';
      if (t.includes('news')) return 'ðŸ“°';
      if (t.includes('talk')) return 'ðŸŽ™ï¸';
      return 'ðŸ“»';
    }
    
    // Select and play station
    function selectStation(index) {
      currentStation = stations[index];
      
      document.getElementById('player-name').textContent = currentStation.name;
      document.getElementById('player-info').textContent = `${currentStation.country || 'Internacional'} â€¢ ${currentStation.codec || 'STREAM'}`;
      document.getElementById('player-emoji').textContent = getStationEmoji(currentStation.tags || '');
      
      playerBar.classList.remove('translate-y-full');
      
      playStation();
    }
    
    // Play current station
    function playStation() {
      if (!currentStation) return;
      
      audio.src = currentStation.url_resolved;
      audio.play().then(() => {
        isPlaying = true;
        updatePlayButton();
        renderStations();
        liveBadge.classList.remove('hidden');
      }).catch(err => {
        console.error('Playback error:', err);
        isPlaying = false;
        updatePlayButton();
      });
    }
    
    // Toggle play/pause
    function togglePlay() {
      if (!currentStation) return;
      
      if (isPlaying) {
        audio.pause();
        isPlaying = false;
        liveBadge.classList.add('hidden');
      } else {
        playStation();
      }
      updatePlayButton();
      renderStations();
    }
    
    // Update play button state
    function updatePlayButton() {
      const playIcon = document.getElementById('play-icon');
      const pauseIcon = document.getElementById('pause-icon');
      const waves = document.getElementById('playing-waves');
      
      if (isPlaying) {
        playIcon.classList.add('hidden');
        pauseIcon.classList.remove('hidden');
        waves.classList.remove('hidden');
      } else {
        playIcon.classList.remove('hidden');
        pauseIcon.classList.add('hidden');
        waves.classList.add('hidden');
      }
    }
    
    // Toggle mute
    function toggleMute() {
      isMuted = !isMuted;
      audio.muted = isMuted;
      
      document.getElementById('volume-on').classList.toggle('hidden', isMuted);
      document.getElementById('volume-off').classList.toggle('hidden', !isMuted);
    }
    
    // Search handler with debounce
    let searchTimeout;
    function handleSearch() {
      const term = searchInput.value.trim();
      clearSearchBtn.classList.toggle('hidden', !term);
      
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        fetchStations(term, currentGenre);
      }, 500);
    }
    
    // Clear search
    function clearSearch() {
      searchInput.value = '';
      clearSearchBtn.classList.add('hidden');
      fetchStations('', currentGenre);
    }
    
    // Genre filter handler
    function handleGenreFilter(e) {
      const btn = e.target.closest('.genre-btn');
      if (!btn) return;
      
      document.querySelectorAll('.genre-btn').forEach(b => {
        b.classList.remove('active', 'bg-violet-500', 'text-white');
        b.classList.add('bg-white/10', 'text-gray-300');
      });
      
      btn.classList.add('active', 'bg-violet-500', 'text-white');
      btn.classList.remove('bg-white/10', 'text-gray-300');
      
      currentGenre = btn.dataset.genre;
      fetchStations(searchInput.value.trim(), currentGenre);
    }
    
    // Event listeners
    searchInput.addEventListener('input', handleSearch);
    clearSearchBtn.addEventListener('click', clearSearch);
    playBtn.addEventListener('click', togglePlay);
    volumeBtn.addEventListener('click', toggleMute);
    document.querySelector('.flex.gap-2.mt-4').addEventListener('click', handleGenreFilter);
    
    // Audio events
    audio.addEventListener('error', () => {
      console.error('Audio error');
      isPlaying = false;
      updatePlayButton();
      liveBadge.classList.add('hidden');
    });
    
    // Element SDK initialization
    async function onConfigChange(config) {
      document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
      searchInput.placeholder = config.search_placeholder || defaultConfig.search_placeholder;
    }
    
    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => window.elementSdk.setConfig({ surface_color: value })
          },
          {
            get: () => config.secondary_color || defaultConfig.secondary_color,
            set: (value) => window.elementSdk.setConfig({ secondary_color: value })
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => window.elementSdk.setConfig({ text_color: value })
          },
          {
            get: () => config.primary_color || defaultConfig.primary_color,
            set: (value) => window.elementSdk.setConfig({ primary_color: value })
          },
          {
            get: () => config.accent_color || defaultConfig.accent_color,
            set: (value) => window.elementSdk.setConfig({ accent_color: value })
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }
    
    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['search_placeholder', config.search_placeholder || defaultConfig.search_placeholder]
      ]);
    }
    
    // Initialize
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
    
    // Load initial stations
    fetchStations();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d32fdf5f6c68cbc',t:'MTc3MTk3ODM1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>